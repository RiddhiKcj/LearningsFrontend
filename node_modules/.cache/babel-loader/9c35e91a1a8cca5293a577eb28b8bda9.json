{"remainingRequest":"/home/riddhi/Desktop/learnings/frontend/node_modules/babel-loader/lib/index.js!/home/riddhi/Desktop/learnings/frontend/node_modules/eslint-loader/index.js??ref--13-0!/home/riddhi/Desktop/learnings/frontend/src/backend/axios/index.js","dependencies":[{"path":"/home/riddhi/Desktop/learnings/frontend/src/backend/axios/index.js","mtime":1574674195945},{"path":"/home/riddhi/Desktop/learnings/frontend/node_modules/cache-loader/dist/cjs.js","mtime":1574162603991},{"path":"/home/riddhi/Desktop/learnings/frontend/node_modules/babel-loader/lib/index.js","mtime":1574162576952},{"path":"/home/riddhi/Desktop/learnings/frontend/node_modules/eslint-loader/index.js","mtime":1574162599530}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:aW1wb3J0ICJjb3JlLWpzL21vZHVsZXMvZXMuc3ltYm9sIjsKaW1wb3J0ICJjb3JlLWpzL21vZHVsZXMvZXMuYXJyYXkuZmlsdGVyIjsKaW1wb3J0ICJjb3JlLWpzL21vZHVsZXMvZXMuYXJyYXkuZm9yLWVhY2giOwppbXBvcnQgImNvcmUtanMvbW9kdWxlcy9lcy5vYmplY3QuZ2V0LW93bi1wcm9wZXJ0eS1kZXNjcmlwdG9yIjsKaW1wb3J0ICJjb3JlLWpzL21vZHVsZXMvZXMub2JqZWN0LmdldC1vd24tcHJvcGVydHktZGVzY3JpcHRvcnMiOwppbXBvcnQgImNvcmUtanMvbW9kdWxlcy9lcy5vYmplY3Qua2V5cyI7CmltcG9ydCAiY29yZS1qcy9tb2R1bGVzL2VzLm9iamVjdC50by1zdHJpbmciOwppbXBvcnQgImNvcmUtanMvbW9kdWxlcy9lcy5yZWdleHAuZXhlYyI7CmltcG9ydCAiY29yZS1qcy9tb2R1bGVzL2VzLnN0cmluZy5yZXBsYWNlIjsKaW1wb3J0ICJjb3JlLWpzL21vZHVsZXMvd2ViLmRvbS1jb2xsZWN0aW9ucy5mb3ItZWFjaCI7CmltcG9ydCBfZGVmaW5lUHJvcGVydHkgZnJvbSAiL2hvbWUvcmlkZGhpL0Rlc2t0b3AvbGVhcm5pbmdzL2Zyb250ZW5kL25vZGVfbW9kdWxlcy9AYmFiZWwvcnVudGltZS1jb3JlanMzL2hlbHBlcnMvZXNtL2RlZmluZVByb3BlcnR5IjsKCmZ1bmN0aW9uIG93bktleXMob2JqZWN0LCBlbnVtZXJhYmxlT25seSkgeyB2YXIga2V5cyA9IE9iamVjdC5rZXlzKG9iamVjdCk7IGlmIChPYmplY3QuZ2V0T3duUHJvcGVydHlTeW1ib2xzKSB7IHZhciBzeW1ib2xzID0gT2JqZWN0LmdldE93blByb3BlcnR5U3ltYm9scyhvYmplY3QpOyBpZiAoZW51bWVyYWJsZU9ubHkpIHN5bWJvbHMgPSBzeW1ib2xzLmZpbHRlcihmdW5jdGlvbiAoc3ltKSB7IHJldHVybiBPYmplY3QuZ2V0T3duUHJvcGVydHlEZXNjcmlwdG9yKG9iamVjdCwgc3ltKS5lbnVtZXJhYmxlOyB9KTsga2V5cy5wdXNoLmFwcGx5KGtleXMsIHN5bWJvbHMpOyB9IHJldHVybiBrZXlzOyB9CgpmdW5jdGlvbiBfb2JqZWN0U3ByZWFkKHRhcmdldCkgeyBmb3IgKHZhciBpID0gMTsgaSA8IGFyZ3VtZW50cy5sZW5ndGg7IGkrKykgeyB2YXIgc291cmNlID0gYXJndW1lbnRzW2ldICE9IG51bGwgPyBhcmd1bWVudHNbaV0gOiB7fTsgaWYgKGkgJSAyKSB7IG93bktleXMoc291cmNlLCB0cnVlKS5mb3JFYWNoKGZ1bmN0aW9uIChrZXkpIHsgX2RlZmluZVByb3BlcnR5KHRhcmdldCwga2V5LCBzb3VyY2Vba2V5XSk7IH0pOyB9IGVsc2UgaWYgKE9iamVjdC5nZXRPd25Qcm9wZXJ0eURlc2NyaXB0b3JzKSB7IE9iamVjdC5kZWZpbmVQcm9wZXJ0aWVzKHRhcmdldCwgT2JqZWN0LmdldE93blByb3BlcnR5RGVzY3JpcHRvcnMoc291cmNlKSk7IH0gZWxzZSB7IG93bktleXMoc291cmNlKS5mb3JFYWNoKGZ1bmN0aW9uIChrZXkpIHsgT2JqZWN0LmRlZmluZVByb3BlcnR5KHRhcmdldCwga2V5LCBPYmplY3QuZ2V0T3duUHJvcGVydHlEZXNjcmlwdG9yKHNvdXJjZSwga2V5KSk7IH0pOyB9IH0gcmV0dXJuIHRhcmdldDsgfQoKaW1wb3J0IGF4aW9zIGZyb20gJ2F4aW9zJzsKdmFyIEFQSV9VUkwgPSAnaHR0cDovL2xvY2FsaG9zdDozMDAwJzsKdmFyIHNlY3VyZWRBeGlvc0luc3RhbmNlID0gYXhpb3MuY3JlYXRlKHsKICBiYXNlVVJMOiBBUElfVVJMLAogIHdpdGhDcmVkZW50aWFsczogdHJ1ZSwKICBoZWFkZXJzOiB7CiAgICAnQ29udGVudC1UeXBlJzogJ2FwcGxpY2F0aW9uL2pzb24nCiAgfQp9KTsKdmFyIHBsYWluQXhpb3NJbnN0YW5jZSA9IGF4aW9zLmNyZWF0ZSh7CiAgYmFzZVVSTDogQVBJX1VSTCwKICB3aXRoQ3JlZGVudGlhbHM6IHRydWUsCiAgaGVhZGVyczogewogICAgJ0NvbnRlbnQtVHlwZSc6ICdhcHBsaWNhdGlvbi9qc29uJwogIH0KfSk7CnNlY3VyZWRBeGlvc0luc3RhbmNlLmludGVyY2VwdG9ycy5yZXF1ZXN0LnVzZShmdW5jdGlvbiAoY29uZmlnKSB7CiAgdmFyIG1ldGhvZCA9IGNvbmZpZy5tZXRob2QudG9VcHBlckNhc2UoKTsKCiAgaWYgKG1ldGhvZCAhPT0gJ09QVElPTlMnICYmIG1ldGhvZCAhPT0gJ0dFVCcpIHsKICAgIGNvbmZpZy5oZWFkZXJzID0gX29iamVjdFNwcmVhZCh7fSwgY29uZmlnLmhlYWRlcnMsIHsKICAgICAgJ1gtQ1NSRi1UT0tFTic6IGxvY2FsU3RvcmFnZS5jc3JmLAogICAgICAnQXV0aG9yaXphdGlvbic6ICdCZWFyZXIgJyArIGxvY2FsU3RvcmFnZS5hY2Nlc3MKICAgIH0pOwogIH0KCiAgcmV0dXJuIGNvbmZpZzsKfSk7CnNlY3VyZWRBeGlvc0luc3RhbmNlLmludGVyY2VwdG9ycy5yZXNwb25zZS51c2UobnVsbCwgZnVuY3Rpb24gKGVycm9yKSB7CiAgaWYgKGVycm9yLnJlc3BvbnNlICYmIGVycm9yLnJlc3BvbnNlLmNvbmZpZyAmJiBlcnJvci5yZXNwb25zZS5zdGF0dXMgPT09IDQwMSkgewogICAgLy8gSW4gY2FzZSA0MDEgaXMgY2F1c2VkIGJ5IGV4cGlyZWQgYWNjZXNzIGNvb2tpZSAtIHdlJ2xsIGRvIHJlZnJlc2ggcmVxdWVzdAogICAgcmV0dXJuIHBsYWluQXhpb3NJbnN0YW5jZS5wb3N0KCcvcmVmcmVzaCcsIHt9LCB7CiAgICAgIGhlYWRlcnM6IHsKICAgICAgICAnWC1DU1JGLVRPS0VOJzogbG9jYWxTdG9yYWdlLmNzcmYsCiAgICAgICAgJ0F1dGhvcml6YXRpb24nOiAnQmVhcmVyICcgKyBsb2NhbFN0b3JhZ2UuYWNjZXNzCiAgICAgIH0KICAgIH0pLnRoZW4oZnVuY3Rpb24gKHJlc3BvbnNlKSB7CiAgICAgIGxvY2FsU3RvcmFnZS5jc3JmID0gcmVzcG9uc2UuZGF0YS5jc3JmOwogICAgICBsb2NhbFN0b3JhZ2UuYWNjZXNzID0gcmVzcG9uc2UuZGF0YS5hY2Nlc3M7CiAgICAgIGxvY2FsU3RvcmFnZS5zaWduZWRJbiA9IHRydWU7IC8vIEFuZCBhZnRlciBzdWNjZXNzZnVsIHJlZnJlc2ggLSByZXBlYXQgdGhlIG9yaWdpbmFsIHJlcXVlc3QKCiAgICAgIHZhciByZXRyeUNvbmZpZyA9IGVycm9yLnJlc3BvbnNlLmNvbmZpZzsKICAgICAgcmV0cnlDb25maWcuaGVhZGVyc1snWC1DU1JGLVRPS0VOJ10gPSBsb2NhbFN0b3JhZ2UuY3NyZjsKICAgICAgcmV0dXJuIHBsYWluQXhpb3NJbnN0YW5jZS5yZXF1ZXN0KHJldHJ5Q29uZmlnKTsKICAgIH0pLmNhdGNoKGZ1bmN0aW9uIChlcnJvcikgewogICAgICBkZWxldGUgbG9jYWxTdG9yYWdlLmNzcmY7CiAgICAgIGRlbGV0ZSBsb2NhbFN0b3JhZ2UuYWNjZXNzOwogICAgICBkZWxldGUgbG9jYWxTdG9yYWdlLnNpZ25lZEluOyAvLyByZWRpcmVjdCB0byBzaWduaW4gaW4gY2FzZSByZWZyZXNoIHJlcXVlc3QgZmFpbHMKCiAgICAgIGxvY2F0aW9uLnJlcGxhY2UoJy8nKTsKICAgICAgcmV0dXJuIFByb21pc2UucmVqZWN0KGVycm9yKTsKICAgIH0pOwogIH0gZWxzZSB7CiAgICByZXR1cm4gUHJvbWlzZS5yZWplY3QoZXJyb3IpOwogIH0KfSk7CmV4cG9ydCB7IHNlY3VyZWRBeGlvc0luc3RhbmNlLCBwbGFpbkF4aW9zSW5zdGFuY2UgfTs="},{"version":3,"sources":["/home/riddhi/Desktop/learnings/frontend/src/backend/axios/index.js"],"names":["axios","API_URL","securedAxiosInstance","create","baseURL","withCredentials","headers","plainAxiosInstance","interceptors","request","use","config","method","toUpperCase","localStorage","csrf","access","response","error","status","post","then","data","signedIn","retryConfig","catch","location","replace","Promise","reject"],"mappings":";;;;;;;;;;;;;;;;AAAA,OAAOA,KAAP,MAAkB,OAAlB;AAEA,IAAMC,OAAO,GAAG,uBAAhB;AAEA,IAAMC,oBAAoB,GAAGF,KAAK,CAACG,MAAN,CAAa;AACxCC,EAAAA,OAAO,EAAEH,OAD+B;AAExCI,EAAAA,eAAe,EAAE,IAFuB;AAGxCC,EAAAA,OAAO,EAAE;AACP,oBAAgB;AADT;AAH+B,CAAb,CAA7B;AAQA,IAAMC,kBAAkB,GAAGP,KAAK,CAACG,MAAN,CAAa;AACtCC,EAAAA,OAAO,EAAEH,OAD6B;AAEtCI,EAAAA,eAAe,EAAE,IAFqB;AAGtCC,EAAAA,OAAO,EAAE;AACP,oBAAgB;AADT;AAH6B,CAAb,CAA3B;AAQAJ,oBAAoB,CAACM,YAArB,CAAkCC,OAAlC,CAA0CC,GAA1C,CAA8C,UAAAC,MAAM,EAAI;AACtD,MAAMC,MAAM,GAAGD,MAAM,CAACC,MAAP,CAAcC,WAAd,EAAf;;AACA,MAAID,MAAM,KAAK,SAAX,IAAwBA,MAAM,KAAK,KAAvC,EAA8C;AAC5CD,IAAAA,MAAM,CAACL,OAAP,qBACKK,MAAM,CAACL,OADZ;AAEE,sBAAgBQ,YAAY,CAACC,IAF/B;AAGE,uBAAiB,YAAYD,YAAY,CAACE;AAH5C;AAKD;;AACD,SAAOL,MAAP;AACD,CAVD;AAYAT,oBAAoB,CAACM,YAArB,CAAkCS,QAAlC,CAA2CP,GAA3C,CAA+C,IAA/C,EAAqD,UAAAQ,KAAK,EAAI;AAC5D,MAAIA,KAAK,CAACD,QAAN,IAAkBC,KAAK,CAACD,QAAN,CAAeN,MAAjC,IAA2CO,KAAK,CAACD,QAAN,CAAeE,MAAf,KAA0B,GAAzE,EAA8E;AAC5E;AACA,WAAOZ,kBAAkB,CAACa,IAAnB,CAAwB,UAAxB,EAAoC,EAApC,EAAwC;AAAEd,MAAAA,OAAO,EAAE;AAAE,wBAAgBQ,YAAY,CAACC,IAA/B;AAAqC,yBAAiB,YAAYD,YAAY,CAACE;AAA/E;AAAX,KAAxC,EACJK,IADI,CACC,UAAAJ,QAAQ,EAAI;AAChBH,MAAAA,YAAY,CAACC,IAAb,GAAoBE,QAAQ,CAACK,IAAT,CAAcP,IAAlC;AACAD,MAAAA,YAAY,CAACE,MAAb,GAAsBC,QAAQ,CAACK,IAAT,CAAcN,MAApC;AACAF,MAAAA,YAAY,CAACS,QAAb,GAAwB,IAAxB,CAHgB,CAIhB;;AACA,UAAIC,WAAW,GAAGN,KAAK,CAACD,QAAN,CAAeN,MAAjC;AACAa,MAAAA,WAAW,CAAClB,OAAZ,CAAoB,cAApB,IAAsCQ,YAAY,CAACC,IAAnD;AACA,aAAOR,kBAAkB,CAACE,OAAnB,CAA2Be,WAA3B,CAAP;AACD,KATI,EASFC,KATE,CASI,UAAAP,KAAK,EAAI;AAChB,aAAOJ,YAAY,CAACC,IAApB;AACA,aAAOD,YAAY,CAACE,MAApB;AACA,aAAOF,YAAY,CAACS,QAApB,CAHgB,CAIhB;;AACAG,MAAAA,QAAQ,CAACC,OAAT,CAAiB,GAAjB;AACA,aAAOC,OAAO,CAACC,MAAR,CAAeX,KAAf,CAAP;AACD,KAhBI,CAAP;AAiBD,GAnBD,MAmBO;AACL,WAAOU,OAAO,CAACC,MAAR,CAAeX,KAAf,CAAP;AACD;AACF,CAvBD;AAyBA,SAAShB,oBAAT,EAA+BK,kBAA/B","sourcesContent":["import axios from 'axios'\n\nconst API_URL = 'http://localhost:3000'\n\nconst securedAxiosInstance = axios.create({\n  baseURL: API_URL,\n  withCredentials: true,\n  headers: {\n    'Content-Type': 'application/json' \n  }   \n})\n\nconst plainAxiosInstance = axios.create({\n  baseURL: API_URL,\n  withCredentials: true,\n  headers: {\n    'Content-Type': 'application/json'\n  }\n})\n\nsecuredAxiosInstance.interceptors.request.use(config => {\n  const method = config.method.toUpperCase()\n  if (method !== 'OPTIONS' && method !== 'GET') {\n    config.headers = {\n      ...config.headers,\n      'X-CSRF-TOKEN': localStorage.csrf,\n      'Authorization': 'Bearer ' + localStorage.access\n    }\n  }\n  return config\n})\n\nsecuredAxiosInstance.interceptors.response.use(null, error => {\n  if (error.response && error.response.config && error.response.status === 401) {\n    // In case 401 is caused by expired access cookie - we'll do refresh request\n    return plainAxiosInstance.post('/refresh', {}, { headers: { 'X-CSRF-TOKEN': localStorage.csrf, 'Authorization': 'Bearer ' + localStorage.access } })\n      .then(response => {\n        localStorage.csrf = response.data.csrf\n        localStorage.access = response.data.access\n        localStorage.signedIn = true\n        // And after successful refresh - repeat the original request\n        let retryConfig = error.response.config\n        retryConfig.headers['X-CSRF-TOKEN'] = localStorage.csrf\n        return plainAxiosInstance.request(retryConfig)\n      }).catch(error => {\n        delete localStorage.csrf\n        delete localStorage.access\n        delete localStorage.signedIn\n        // redirect to signin in case refresh request fails\n        location.replace('/')\n        return Promise.reject(error)\n      })\n  } else {\n    return Promise.reject(error)\n  }\n})\n\nexport { securedAxiosInstance, plainAxiosInstance }"]}]}